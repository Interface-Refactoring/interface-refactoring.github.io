<!doctype html>
<!--
  Minimal Mistakes Jekyll Theme 4.23.0 by Michael Rose
  Copyright 2013-2020 Michael Rose - mademistakes.com | @mmistakes
  Free for personal and commercial use under the MIT license
  https://github.com/mmistakes/minimal-mistakes/blob/master/LICENSE
-->
<html lang="en" class="no-js">
  <head>
    <meta charset="utf-8">

<!-- begin _includes/seo.html --><title>Introduce Data Transfer Object - Interface Refactoring Catalog</title>
<meta name="description" content="also known as: Map and Wrap Representation Structure, Ubiquitous Language Wrapper">



<meta property="og:type" content="article">
<meta property="og:locale" content="en_US">
<meta property="og:site_name" content="Interface Refactoring Catalog">
<meta property="og:title" content="Introduce Data Transfer Object">
<meta property="og:url" content="/refactorings/introducedatatransferobject">


  <meta property="og:description" content="also known as: Map and Wrap Representation Structure, Ubiquitous Language Wrapper">







  <meta property="article:published_time" content="2024-10-11T11:38:39+02:00">






<link rel="canonical" href="/refactorings/introducedatatransferobject">




<script type="application/ld+json">
  {
    "@context": "https://schema.org",
    
      "@type": "Person",
      "name": null,
      "url": "/"
    
  }
</script>


  <meta name="google-site-verification" content="x8wyOj5Ci0-5V8KvrqNeZ90_I9sOVHog3UqCKVUem28" />






<!-- end _includes/seo.html -->



  <link href="/feed.xml" type="application/atom+xml" rel="alternate" title="Interface Refactoring Catalog Feed">


<!-- https://t.co/dKP3o1e -->
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script>
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
</script>

<!-- For all browsers -->
<link rel="stylesheet" href="/assets/css/main.css">
<link rel="preload" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5/css/all.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
<noscript><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5/css/all.min.css"></noscript>

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.0.1/styles/arduino-light.min.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.0.1/highlight.min.js"></script>
<script>
  document.addEventListener('DOMContentLoaded', (event) => {
      hljs.registerLanguage("mdsl", function(hljs) {
          return {
            keywords: {
                        // See https://highlightjs.readthedocs.io/en/latest/css-classes-reference.html
                        keyword: "API IPA description data type endpoint operation provider client gateway responsibility serves as exposes offers consumes expecting delivering scenario story supports with a wants to so that via protocol binding resource at element realized as location and mediates from to",
                        literal: 'header payload "GET" "PUT" "POST" "PATCH" "DELETE" "HTTP"', // not sure about this group 
                        operator: "* + ? !",
                        type: "ID D MD L P string int long bool raw Identifier Data Metadata Link",
                        built_in: "PROCESSING_RESOURCE INFORMATION_HOLDER_RESOURCE COLLECTION_RESOURCE STATE_CREATION_OPERATION RETRIEVAL_OPERATION STATE_TRANSITION_OPERATION STATE_DELETION_OPERATION STATE_REPLACEMENT_OPERATION COMPUTATION_FUNCTION Pagination Wish_List Wish_Template Request_Bundle Context_Representation"
                    },
                    contains: [
                        hljs.C_LINE_COMMENT_MODE,
                        hljs.C_BLOCK_COMMENT_MODE,
                        hljs.QUOTE_STRING_MODE
                    ]
          }
      });
      hljs.registerLanguage("cml", function(hljs) {
          return {
              keywords: {
                  keyword: "Aggregate Service",
                  type: "String",
              },
              contains: [
                  hljs.C_LINE_COMMENT_MODE,
                  hljs.C_BLOCK_COMMENT_MODE
              ]
          }
      });
      hljs.initHighlighting();
  });
</script>
<!--[if IE]>
  <style>
    /* old IE unsupported flexbox fixes */
    .greedy-nav .site-title {
      padding-right: 3em;
    }
    .greedy-nav button {
      position: absolute;
      top: 0;
      right: 0;
      height: 100%;
    }
  </style>
<![endif]-->



    <!-- start custom head snippets -->

<!-- insert favicons. use https://realfavicongenerator.net/ -->



<link rel="icon" type="image/png" sizes="32x32" href="/assets/images/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/assets/images/favicon-16x16.png">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">


<!-- end custom head snippets -->

  </head>

  <body class="layout--single wide refactoring">
    <nav class="skip-links">
  <ul>
    <li><a href="#site-nav" class="screen-reader-shortcut">Skip to primary navigation</a></li>
    <li><a href="#main" class="screen-reader-shortcut">Skip to content</a></li>
    <li><a href="#footer" class="screen-reader-shortcut">Skip to footer</a></li>
  </ul>
</nav>

    <!--[if lt IE 9]>
<div class="notice--danger align-center" style="margin: 0;">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience.</div>
<![endif]-->

    

<div class="masthead">
  <div class="masthead__inner-wrap">
    <div class="masthead__menu">
      <nav id="site-nav" class="greedy-nav">
        
          <a class="site-logo" href="/"><img src="/assets/images/logo.png" alt="Interface Refactoring Catalog"></a>
        
        <a class="site-title" href="/">
          Interface Refactoring Catalog
          
        </a>
        <ul class="visible-links"><li class="masthead__menu-item">
              <a href="/refactorings/by-stakeholder-concerns">Stakeholder Concerns</a>
            </li><li class="masthead__menu-item">
              <a href="/refactorings/by-smells-drivers">Smells</a>
            </li><li class="masthead__menu-item">
              <a href="/about/">About</a>
            </li></ul>
        
        <button class="search__toggle" type="button">
          <span class="visually-hidden">Toggle search</span>
          <i class="fas fa-search"></i>
        </button>
        
        <button class="greedy-nav__toggle hidden" type="button">
          <span class="visually-hidden">Toggle menu</span>
          <div class="navicon"></div>
        </button>
        <ul class="hidden-links hidden"></ul>
      </nav>
    </div>
  </div>
</div>


    <div class="initial-content">
      


  
    



<nav class="breadcrumbs">
  <ol itemscope itemtype="https://schema.org/BreadcrumbList">
    
    
    
      
        <li itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
          <a href="/" itemprop="item"><span itemprop="name">Home</span></a>
          <meta itemprop="position" content="1" />
        </li>
        <span class="sep">/</span>
      
      
        
        <li itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
          <a href="/refactorings" itemprop="item"><span itemprop="name">Refactorings</span></a>
          <meta itemprop="position" content="2" />
        </li>
        <span class="sep">/</span>
      
    
      
      
        <li class="current">Introduce Data Transfer Object</li>
      
    
  </ol>
</nav>

  


<div id="main" role="main">
  
  <div class="sidebar sticky">
  
  
    
      
      
      
      
    
    
      

<nav class="nav__list">
  
  <input id="ac-toc" name="accordion-toc" type="checkbox" />
  <label for="ac-toc">Toggle Menu</label>
  <ul class="nav__items">
    
      <li>
          <span class="nav__sub-title">Introduce Data Transfer Object</span>
          <ul><li><a href="#context-and-motivation">Context and Motivation</a></li><li><a href="#stakeholder-concerns">Stakeholder Concerns</a></li><li><a href="#initial-position-sketch">Initial Position Sketch</a></li><li><a href="#design-smells">Design Smells</a></li><li><a href="#instructions">Instructions</a></li><li><a href="#target-solution-sketch-evolution-outline">Target Solution Sketch (Evolution Outline)</a></li><li><a href="#examples">Example(s)</a></li><li><a href="#hints-and-pitfalls-to-avoid">Hints and Pitfalls to Avoid</a></li><li><a href="#related-content">Related Content</a></li><li><a href="#references">References</a></li></ul>

      </li>
    
    <li>
      <ul>
        <span class="nav__sub-title">Refactorings Index</span>
        
          <li><a href="/refactorings/addwishlist">Add Wish List </a></li>
        
          <li><a href="/refactorings/addwishtemplate">Add Wish Template </a></li>
        
          <li><a href="/refactorings/bundlerequests">Bundle Requests </a></li>
        
          <li><a href="/refactorings/encapsulatecontextrepresentation">Encapsulate Context Representation </a></li>
        
          <li><a href="/refactorings/extractinformationholder">Extract Information Holder </a></li>
        
          <li><a href="/refactorings/extractoperation">Extract Operation </a></li>
        
          <li><a href="/refactorings/inlineinformationholder">Inline Information Holder </a></li>
        
          <li><a href="/refactorings/introducedatatransferobject">Introduce Data Transfer Object </a></li>
        
          <li><a href="/refactorings/introducepagination">Introduce Pagination </a></li>
        
          <li><a href="/refactorings/introduceversionidentifier">Introduce Version Identifier </a></li>
        
          <li><a href="/refactorings/introduceversionmediator">Introduce Version Mediator </a></li>
        
          <li><a href="/refactorings/makerequestconditional">Make Request Conditional </a></li>
        
          <li><a href="/refactorings/mergeendpoints">Merge Endpoints </a></li>
        
          <li><a href="/refactorings/mergeoperations">Merge Operations </a></li>
        
          <li><a href="/refactorings/moveoperation">Move Operation </a></li>
        
          <li><a href="/refactorings/relaxevolutionstrategy">Relax Evolution Strategy </a></li>
        
          <li><a href="/refactorings/renameendpoint">Rename Endpoint </a></li>
        
          <li><a href="/refactorings/renameoperation">Rename Operation </a></li>
        
          <li><a href="/refactorings/renamerepresentationelement">Rename Representation Element </a></li>
        
          <li><a href="/refactorings/segregatecommandsfromqueries">Segregate Commands from Queries </a></li>
        
          <li><a href="/refactorings/splitoperation">Split Operation </a></li>
        
          <li><a href="/refactorings/tightenevolutionstrategy">Tighten Evolution Strategy </a></li>
        
      </ul>
    </li>
    
      <li>
        
          <span class="nav__sub-title">Browse Refactorings</span>
        

        
        <ul>
          
            <li><a href="/refactorings/by-stakeholder-concerns">... by Stakeholder Concerns</a></li>
          
            <li><a href="/refactorings/by-smells-drivers">... by Smells</a></li>
          
            <li><a href="/refactorings">... by Target</a></li>
          
        </ul>
        
      </li>
    
      <li>
        
          <span class="nav__sub-title">Extras</span>
        

        
        <ul>
          
            <li><a href="/news">News</a></li>
          
            <li><a href="/hints">Hints and Sample System</a></li>
          
            <li><a href="/glossary">Glossary</a></li>
          
            <li><a href="/publications">Articles and Books</a></li>
          
            <li><a href="/about">About the Authors</a></li>
          
            <li><a href="/terms">Terms and License</a></li>
          
        </ul>
        
      </li>
    
  </ul>
</nav>

    
  

  </div>



  <article class="page" itemscope itemtype="https://schema.org/CreativeWork">
    <meta itemprop="headline" content="Introduce Data Transfer Object">
    <meta itemprop="description" content="also known as: Map and Wrap Representation Structure, Ubiquitous Language Wrapper">
    <meta itemprop="datePublished" content="2024-10-11T11:38:39+02:00">
    

    <div class="page__inner-wrap">
      
        <header>
          <h1 id="page-title" class="page__title" itemprop="headline">Introduce Data Transfer Object
</h1>
          

  <p class="page__meta">
    
      
      <span class="page__meta-date">
        <strong>Updated:</strong>
        
        <time datetime="2023-10-07T00:00:00+02:00">October 7, 2023</time>
      </span>
    
    
      <span class="page__meta-workshopped">
        <strong>Published:</strong> EuroPLoP 2023
      </span>
    

    

    
  </p>


        </header>
      

      
        
      

      <section class="page__content" itemprop="text">
        <p>also known as: Map and Wrap Representation Structure, Ubiquitous Language Wrapper</p>

<h2 id="context-and-motivation">Context and Motivation</h2>

<p>An API offers one or more operations that return <a href="https://api-patterns.org/patterns/structure/elementStereotypes/DataElement">Data Elements</a> [<a href="#ref-PatternsForAPIDesign:2022">Zimmermann et al. 2022</a>]. For example, the API of a customer relationship management service might contain an endpoint that returns detailed information about customers and the interactions with them. The structure of these responses might have been derived from the API implementation classes and domain model data structures, with possibly deeply nested structures of elements [<a href="#ref-MAP-DDD:ICSA:2021">Singjai, Zdun, and Zimmermann 2021</a>]. For example, an API implementation might use an <a href="https://en.wikipedia.org/wiki/Object-relational_mapping">Object-Relational</a> Mapper (ORM) to manage the data and might return serializations of instances of the ORM classes in the response messages.</p>

<p class="notice--primary">As an API provider, I want to encapsulate my internal data structures so that I can freely change them without breaking backward compatibility of my clients. In domain-driven design terms, I want to keep the integration-level published language separate from the application-level ubiquitous language<sup id="fnref:1" role="doc-noteref"><a href="#fn:1" class="footnote" rel="footnote">1</a></sup>.</p>

<h2 id="stakeholder-concerns">Stakeholder Concerns</h2>

<dl>
  <dt><a href="/refactorings/by-stakeholder-concerns/#modifiability">#modifiability</a>, <a href="/refactorings/by-stakeholder-concerns/#evolvability">#evolvability</a>, and <a href="/refactorings/by-stakeholder-concerns/#information-hiding">#information-hiding</a></dt>
  <dd>API providers want the freedom to change the API implementation without revealing such changes to clients. Such information hiding [<a href="#ref-Parnas:1972">Parnas 1972</a>] is crucial for the independent evolvability of API providers and clients.</dd>
  <dt><a href="/refactorings/by-stakeholder-concerns/#developer-experience">#developer-experience</a></dt>
  <dd>API clients want to navigate the required data with minimum effort, taking as few coding steps (expressed as statements and expressions) as possible.</dd>
  <dt><a href="/refactorings/by-stakeholder-concerns/#cohesion">#cohesion</a>, <a href="/refactorings/by-stakeholder-concerns/#coupling">#coupling</a></dt>
  <dd>API providers strive for low coupling and high cohesion in their endpoint, operation, and message designs.</dd>
</dl>

<h2 id="initial-position-sketch">Initial Position Sketch</h2>

<p>The refactoring is eligible for any API operation that uses an implementation type (for example, a domain class or a database-mapped entity) in a request or response message. Note that this implementation type may also appear as a subordinate element within a message structure hierarchy.</p>

<p>For instance, an API provider might return data from a repository directly to the client, as shown in Figure 1. The structure and content of the data are not changed; it is simply passed through.</p>

<p><img src="/refactorings/images/IntroduceDataTransferObject_Initial.png" alt="Introduce Data Transfer Object: Initial Position Sketch. The API provider responds to a client request (1) with a message (2) that contains some data elements." /></p>

<p>Figure 1: Introduce Data Transfer Object: Initial Position Sketch. The API provider responds to a client request (1) with a message (2) that contains some data elements.</p>

<h2 id="design-smells">Design Smells</h2>

<dl>
  <dt><em><a href="/refactorings/by-smells-drivers#leaky-encapsulation">Leaky encapsulation</a></em></dt>
  <dd>Domain layer language constructs (e.g., classes) or abstractions defined in the persistence layer are directly exposed in the API. Such permeable or even completely missing encapsulation of API internal data structures makes an API harder to evolve because it introduces coupling and harms backward compatibility.</dd>
  <dt><em><a href="/refactorings/by-smells-drivers#tight-coupling-of-data-contract">Tight coupling of data contract</a></em></dt>
  <dd>Anything exposed will be used according to <a href="https://www.hyrumslaw.com/">Hyrum’s Law</a>. Hence, leaky encapsulations cause undesired coupling, which may slow development and decrease <a href="/refactorings/by-stakeholder-concerns/#modifiability">modifiability</a> and <a href="/refactorings/by-stakeholder-concerns/#flexibility">flexibility</a>.</dd>
  <dt><em><a href="/refactorings/by-smells-drivers#confetti-design">Confetti design</a></em></dt>
  <dd>Clients might have to issue many requests to get all the needed data. Fine-grained APIs that rain many small <a href="https://api-patterns.org/patterns/structure/elementStereotypes/DataElement">Data Elements</a> on clients are rather flexible but can be tedious to use.</dd>
</dl>

<h2 id="instructions">Instructions</h2>

<p>To replace an implementation type in a response message with a DTO, perform the following steps:</p>

<ol>
  <li>Create a new data-centric wrapper (e.g., a class in object-oriented languages) that mirrors the attributes of the current message representation. Such <em>Data Transfer Objects</em> (DTOs) [<a href="#ref-PoEAA">Fowler 2002</a>] are typically implemented as immutable Value Objects [<a href="#ref-Evans:2003">Evans 2003</a>] with structural, value-based equality.</li>
  <li>Depending on the implementation framework, add additional serialization logic or mapping configuration information. An example is the JSON-to-Java data binding offered by libraries such as <a href="https://github.com/FasterXML/jackson-databind">Jackson</a>.</li>
  <li>Write unit tests for the DTOs and the mapping logic. If the framework generates the code, such tests might be unnecessary (or already provided by the framework).</li>
  <li>Adjust the implementation of the operation to create an instance of the DTO and fill it with the necessary data.</li>
  <li>Return the DTO from the operation implementation, adjusting any return types if necessary (so that the new serialization logic can pick them up).</li>
  <li>Run the tests to ensure the message structure was not changed accidentally. For example, an integration test might check whether all attributes expected in a JSON object are present.</li>
  <li>Include the API change in the <a href="https://api-patterns.org/patterns/foundation/APIDescription">API Description</a> if it is visible there; for example, adjust the JSON-Schema part of the OpenAPI description of the API.</li>
  <li>Align the sample data in supplemental API documentation artifacts such as tutorials so that it the new structure is featured.</li>
</ol>

<p>These instructions assume that the DTO is introduced in a response message. If a request message is the target, steps 4 and 5 must be adapted. Instead of creating and returning a DTO, adjust the implementation of the operation to take the DTO as a parameter and convert it back to the API-internal data representation. This refactoring is fully backward-compatible because it only changes the implementation, not the structure of the message.</p>

<h2 id="target-solution-sketch-evolution-outline">Target Solution Sketch (Evolution Outline)</h2>

<p>When the refactoring has been applied, a mapping step takes place that copies the data to/from the DTO structure. The mapping can preserve the structure or adjust it, depending on the information needs of the message recipient. Figure 2 shows a refactored response message.</p>

<p><img src="/refactorings/images/IntroduceDataTransferObject_Target.png" alt="Introduce Data Transfer Object: Target Solution Sketch. Instead of passing through the data for the client's request (1), an additional DTO mapper transforms the data elements before they are returned (2). The implementation types can be changed without affecting the API." /></p>

<p>Figure 2: Introduce Data Transfer Object: Target Solution Sketch. Instead of passing through the data for the client’s request (1), an additional DTO mapper transforms the data elements before they are returned (2). The implementation types can be changed without affecting the API.</p>

<p>Now that the internal implementation has been decoupled from the response entity, the DTO can transfer additional data, such as <a href="https://api-patterns.org/patterns/quality/referenceManagement/EmbeddedEntity">Embedded Entities</a>, <a href="https://api-patterns.org/patterns/structure/elementStereotypes/LinkElement">Link Elements</a>, or <a href="https://api-patterns.org/patterns/structure/elementStereotypes/MetadataElement">Metadata Elements</a>. Such richer messages help against <a href="/refactorings/by-smells-drivers/#confetti-design">confetti design</a>.</p>

<p>If the internal implementation type evolves, the DTO can implement more complex mapping logic to maintain backward compatibility. Additional metadata, such as a <a href="https://api-patterns.org/patterns/evolution/VersionIdentifier">Version Identifier</a>, can also be added to the DTO.</p>

<h2 id="examples">Example(s)</h2>

<p>The following excerpt from a Java Spring Boot controller shows an implementation of an operation <code>getMyEntity</code> that fetches an entity from a database repository and directly returns it in its response:</p>

<pre><code class="language-java">@GetMapping(value = "/{id}")
public ResponseEntity&lt;MyEntity&gt; getMyEntity(
        @ApiParam(value = "the entity's unique id") 
            @PathVariable MyEntityId id) {

    MyEntity myEntity = myEntityRepository.getMyEntity(id);
    if (myEntity == null) {
        throw new ResponseStatusException(
            HttpStatus.NOT_FOUND, "Entity Not Found");
    }
    return ResponseEntity.ok(myEntity);
}
</code></pre>

<p>The Spring <code>GetMapping</code> annotation turns the <code>getMyEntity</code> method into an API operation (HTTP GET) that receives an <code>id</code> parameter and returns a <code>ResponseEntity</code>. The <code>ResponseEntity</code> class has helper methods – such as <code>ok</code> – to generate HTTP messages (<code>200 OK</code> in this case).</p>

<p>The <code>MyEntity</code> class is also used in the object-relational mapping in this example. More specifically, the <a href="https://jakarta.ee/specifications/persistence/3.0/jakarta-persistence-spec-3.0.html">Java Persistence API (JPA)</a> is used:</p>

<pre><code class="language-java">@Entity
@Table(name = "my_entities")
public class MyEntity {
  String attribute;
  ...
}
</code></pre>

<p>A sample response could look like this:</p>

<pre><code>HTTP/1.1 200
Content-Type: application/json;charset=UTF-8
{
  "attribute" : "1c184cf1-a51a-433f-979b-24e8f085a189"
}
</code></pre>

<p>When the refactoring has been applied, a <code>MyEntityDto</code> is returned (instead of returning <code>MyEntity</code> directly):</p>

<pre><code class="language-java">@GetMapping(value = "/{id}")
public ResponseEntity&lt;MyEntityDto&gt; getMyEntity(
        @ApiParam(value = "the entity's unique id") 
            @PathVariable MyEntityId id) {

    MyEntity myEntity = myEntityRepository.getMyEntity(id);
    if (myEntity == null) {
        throw new ResponseStatusException(
            HttpStatus.NOT_FOUND, "Entity Not Found");
    }
    MyEntityDto myEntityDto = MyEntityDto.toDto(myEntity);
    return ResponseEntity.ok(myEntityDto);
}
</code></pre>

<p>The <code>MyEntityDto</code> DTO is implemented as follows:</p>

<pre><code class="language-java">public class MyEntityDto {
  // Attributes that mirror those in MyEntity 
  String attribute;
  ...
  
  static MyEntityDto toDto(MyEntity myEntity) {
    // Copy attributes from myEntity to new DTO instance
  }
}
</code></pre>

<p>Because the DTO mirrors the attributes of <code>MyEntity</code>, the resulting HTTP response remains unchanged.</p>

<p>Another example comes from the rapid prototyping framework <a href="https://www.jhipster.tech/">JHipster</a>. The application generator provides the option to generate the Spring Boot code with DTOs. Enabling this option changes the signature of the service class (the <code>+</code> and <code>-</code> stand for added and removed lines, respectively):</p>

<pre><code class="language-diff">-    public Optional&lt;Customer&gt; findOne(Long id) {
+    public Optional&lt;CustomerDTO&gt; findOne(Long id) {
         log.debug("Request to get Customer : {}", id);
         return customerRepository
-            .findById(id);
+            .findById(id).map(customerMapper::toDto);
     }
</code></pre>

<p>The <code>CustomerDTO</code> that replaces <code>Customer</code> as the response type in this example is a simple Java bean with attributes, getters, and setters. For the mapping from entity to DTO and vice-versa, JHipster uses <a href="https://mapstruct.org/">MapStruct</a>, an annotation processor that frees the developer from writing trivial mapping code:</p>

<pre><code class="language-java">import org.mapstruct.Mapper;
@Mapper(componentModel = "spring", uses = {})
public interface CustomerMapper 
    extends EntityMapper&lt;CustomerDTO, Customer&gt; {}
</code></pre>

<p>Note that the refactoring can also be applied to request messages.</p>

<h2 id="hints-and-pitfalls-to-avoid">Hints and Pitfalls to Avoid</h2>

<p>Do not over-eagerly apply this refactoring to all API operations, but use it only when its value is higher than its cost (note: this is general advice that makes sense in most cases). A good reason might be that the implementation data structures change oftzen and these changes should not be reflected in the structure of the API-level response messages.</p>

<p>DTO classes and mappings are often straightforward to create, so various libraries and code-generation tools exist to automate this task. For example, <a href="https://projectlombok.org/features/Data">Lombok</a> is an alternative to MapStruct in the Java ecosystem. The recently introduced <a href="https://openjdk.java.net/jeps/395">Java Records</a> also address this topic.</p>

<p>When using code generation, ensure you know what’s going on behind the scenes and that surprises could be waiting for you (for example, see the third bullet item in <a href="https://www.jhipster.tech/using-dtos/#how-dtos-work-in-jhipster">How DTOs work in JHipster</a>).</p>

<p>When receiving data, be a <a href="https://martinfowler.com/bliki/TolerantReader.html">Tolerant Reader</a> by making “minimum assumptions about the structure” and only consuming the data you need. This approach has the advantage that recipient code will not be affected if unused parts of the DTO change.</p>

<p>Another motivation for the refactoring can be that additional (meta-)data has to be returned, for example, when applying the <a href="/refactorings/introducepagination">Introduce Pagination</a> refactoring.</p>

<p>There is a potential risk of introducing memory leaks in API implementations when developers allocate and release memory manually. Marshaling and unmarshaling of request and response data is often handled by frameworks (for example, JSON to Java and Java to JSON in Jackson when using Spring); caching might occur. Unit tests usually will not catch memory bugs; this requires dedicated reliability tests.</p>

<p>DTOs are meant for communicating with external clients and should not be used internally in the API implementation. If the API implementation needs to pass around data internally, it should use the existing data structures directly. See the article about <a href="https://philcalcado.com/2011/08/01/internal_data_transfer_objects.html">Internal Data Transfer Objects</a> by Phil Calçado for reasons why DTOs should not be used internally.</p>

<h2 id="related-content">Related Content</h2>

<p>The DTOs and related mapping logic are usually placed in an implementation-level <a href="https://martinfowler.com/eaaCatalog/serviceLayer.html">Service Layer</a> [<a href="#ref-PoEAA">Fowler 2002</a>].</p>

<p>Chapter 8, “Evolve APIs”, in [<a href="#ref-PatternsForAPIDesign:2022">Zimmermann et al. 2022</a>] discusses evolution strategies for APIs. Refactorings such as <a href="/refactorings/introduceversionidentifier">Introduce Version Identifier</a>, <a href="/refactorings/introduceversionmediator">Introduce Version Mediator</a>, <a href="/refactorings/relaxevolutionstrategy">Relax Evolution Strategy</a>, and <a href="/refactorings/tightenevolutionstrategy">Tighten Evolution Strategy</a> provide guidance on refactoring an API towards those patterns.</p>

<p>Domain Driven Design (DDD) offers additional techniques and patterns to structure domain classes. A brief introduction to <a href="https://socadk.github.io/design-practice-repository/activities/DPR-TacticDDD.html">Tactic DDD</a> can be found in the Design Practice Repository (DPR) on GitHub and the corresponding DPR eBook [<a href="#ref-DPR:2021">Zimmermann and Stocker 2021</a>].</p>

<p>Many Enterprise Integration Patterns [<a href="#ref-Hohpe:2003">Hohpe and Woolf 2003</a>] are related. For instance, <a href="https://www.enterpriseintegrationpatterns.com/patterns/messaging/DataEnricher.html">Content Enricher</a> and <a href="https://www.enterpriseintegrationpatterns.com/patterns/messaging/ContentFilter.html">Content Filter</a> can be used to wrap and map implementation-internal data.</p>

<p>Step 4 of the <a href="https://socadk.github.io/design-practice-repository/activities/SDPR-StepwiseServiceDesign.html">Stepwise Service Design</a> in DPR [<a href="#ref-DPR:2021">Zimmermann and Stocker 2021</a>] advises to “foresee a Remote Facade that exposes Data Transfer Objects (DTOs) in the request and response messages of its API operations to decouple the (published) languages of frontends and backends and to optimize the message exchange over the network regarding exchange frequency and message size.” The <a href="https://martinfowler.com/eaaCatalog/remoteFacade.html">Remote Facade</a> that is mentioned in the quote helps to “translate coarse-grained methods onto the underlying fine-grained objects.” This means that the DTO can be used to restructure the data so that clients can easily interact with it while using the network efficiently.</p>

<p>Martin Fowler describes the code-level refactoring <em>Introduce Parameter Object</em> in “Refactoring – Improving the Design of Existing Code”[<a href="#ref-Fowler2018">Fowler 2018</a>]. The Refactoring.Guru website features this refactoring as <a href="https://refactoring.guru/introduce-parameter-object">“Introduce Parameter Object”</a>.</p>

<h2 id="references">References</h2>

<div id="refs" class="references csl-bib-body hanging-indent">

  <div id="ref-Evans:2003" class="csl-entry">

    <p>Evans, Eric. 2003. <em>Domain-Driven Design: Tacking Complexity in the Heart of Software</em>. Addison-Wesley.</p>

  </div>

  <div id="ref-PoEAA" class="csl-entry">

    <p>Fowler, Martin. 2002. <em>Patterns of Enterprise Application Architecture</em>. Boston, MA, USA: Addison-Wesley Longman Publishing Co., Inc.</p>

  </div>

  <div id="ref-Fowler2018" class="csl-entry">

    <p>———. 2018. <em>Refactoring: Improving the Design of Existing Code</em>. 2nd ed. Addison-Wesley Signature Series (Fowler). Boston, MA: Addison-Wesley.</p>

  </div>

  <div id="ref-Hohpe:2003" class="csl-entry">

    <p>Hohpe, Gregor, and Bobby Woolf. 2003. <em>Enterprise Integration Patterns: Designing, Building, and Deploying Messaging Solutions</em>. Addison-Wesley.</p>

  </div>

  <div id="ref-Parnas:1972" class="csl-entry">

    <p>Parnas, D. L. 1972. “On the Criteria to Be Used in Decomposing Systems into Modules.” <em>Commun. ACM</em> 15 (12): 1053–58. <a href="https://doi.org/10.1145/361598.361623">https://doi.org/10.1145/361598.361623</a>.</p>

  </div>

  <div id="ref-MAP-DDD:ICSA:2021" class="csl-entry">

    <p>Singjai, Apitchaka, Uwe Zdun, and Olaf Zimmermann. 2021. “Practitioner Views on the Interrelation of Microservice APIs and Domain-Driven Design: A Grey Literature Study Based on Grounded Theory.” In <em>18th IEEE International Conference on Software Architecture (ICSA 2021)</em>. https://doi.org/<a href="https://doi.org/10.5281/zenodo.4493865">https://doi.org/10.5281/zenodo.4493865</a>.</p>

  </div>

  <div id="ref-DPR:2021" class="csl-entry">

    <p>Zimmermann, Olaf, and Mirko Stocker. 2021. <em>Design Practice Reference - Guides and Templates to Craft Quality Software in Style</em>. LeanPub. <a href="https://leanpub.com/dpr">https://leanpub.com/dpr</a>.</p>

  </div>

  <div id="ref-PatternsForAPIDesign:2022" class="csl-entry">

    <p>Zimmermann, Olaf, Mirko Stocker, Daniel Lübke, Uwe Zdun, and Cesare Pautasso. 2022. <em>Patterns for API Design: Simplifying Integration with Loosely Coupled Message Exchanges</em>. Addison-Wesley Signature Series (Vernon). Addison-Wesley Professional.</p>

  </div>

</div>

<div class="footnotes" role="doc-endnotes">
  <ol>
    <li id="fn:1" role="doc-endnote">
      <p>Ubiquitous Language is one of the core patterns in Domain Driven Design [<a href="#ref-Evans:2003">Evans 2003</a>]. <a href="#fnref:1" class="reversefootnote" role="doc-backlink">&#8617;</a></p>
    </li>
  </ol>
</div>

        
      </section>

      <footer class="page__meta">
        
        


      </footer>

      

      
  <nav class="pagination">
    
      <a href="/refactorings/inlineinformationholder" class="pagination--pager" title="Inline Information Holder
">Previous</a>
    
    
      <a href="/refactorings/introducepagination" class="pagination--pager" title="Introduce Pagination
">Next</a>
    
  </nav>

    </div>

    
  </article>

  
  
</div>

    </div>

    
      <div class="search-content">
        <div class="search-content__inner-wrap"><form class="search-content__form" onkeydown="return event.key != 'Enter';">
    <label class="sr-only" for="search">
      Enter your search term...
    </label>
    <input type="search" id="search" class="search-input" tabindex="-1" placeholder="Enter your search term..." />
  </form>
  <div id="results" class="results"></div></div>

      </div>
    

    <div id="footer" class="page__footer">
      <footer>
        <!-- start custom footer snippets -->

<script>
  var coll = document.getElementsByClassName("collapsible");
  var i;

  for (i = 0; i < coll.length; i++) {
    coll[i].addEventListener("click", function() {
      this.classList.toggle("active");
    });
  }
</script>

<script>
  function collapseAll() {
    var collapsible = document.getElementsByClassName("collapsible");
    var i;

    for (i = 0; i < coll.length; i++) {
      coll[i].classList.remove("active");
    }
  }

  function expandAll() {
    var collapsible = document.getElementsByClassName("collapsible");
    var i;

    for (i = 0; i < coll.length; i++) {
      coll[i].classList.add("active");
    }
  }
  </script>

<!-- end custom footer snippets -->
        <div class="page__footer-follow">
  <ul class="social-icons">
    

    
      
        
          <li><a href="https://twitter.com/m_st" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-twitter-square" aria-hidden="true"></i> Twitter</a></li>
        
      
        
          <li><a href="https://github.com/Interface-Refactoring/" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-github" aria-hidden="true"></i> GitHub</a></li>
        
      
    

    
      <li><a href="/feed.xml"><i class="fas fa-fw fa-rss-square" aria-hidden="true"></i> Feed</a></li>
    
  </ul>
</div>

<div class="page__footer-copyright">&copy; 2024 Mirko Stocker &amp; Olaf Zimmermann. Powered by <a href="https://jekyllrb.com" rel="nofollow">Jekyll</a> &amp; <a href="https://mademistakes.com/work/minimal-mistakes-jekyll-theme/" rel="nofollow">Minimal Mistakes</a>.</div>

      </footer>
    </div>

    
  <script src="/assets/js/main.min.js"></script>




<script src="/assets/js/lunr/lunr.min.js"></script>
<script src="/assets/js/lunr/lunr-store.js"></script>
<script src="/assets/js/lunr/lunr-en.js"></script>





<!-- Matomo -->
<script type="text/javascript">
  var _paq = window._paq || [];
  /* tracker methods like "setCustomDimension" should be called before "trackPageView" */
  _paq.push(['trackPageView']);
  _paq.push(['enableLinkTracking']);
  (function() {
    var u="//matomo.microservice-api-patterns.org/";
    _paq.push(['setTrackerUrl', u+'matomo.php']);
    _paq.push(['setSiteId', '2']);
    var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];
    g.type='text/javascript'; g.async=true; g.defer=true; g.src=u+'matomo.js'; s.parentNode.insertBefore(g,s);
  })();
</script>
<!-- End Matomo Code -->









  </body>
</html>
